---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Cards.astro";

const API_URL_CAT = "http://localhost:1337/api/categories?populate=books";

const responseCat = await fetch(API_URL_CAT);
const dataCat = await responseCat.json();
const cats = dataCat.data;

// Default category and books initialization
let selectedCategory = cats[0];
let books = selectedCategory.books;
---

<Layout>
  <section>
    <h2>Books</h2>

    <div class="categories">
      {cats.map((cat) => (
        <button
          class="categories__catBtn"
          data-category-id={cat.documentId}
        >
          {cat.name}
        </button>
      ))}
    </div>

    <div class="card-container">
      {books.map((book) => (
        <Card book={book} />
      ))}
    </div>
  </section>

  <script type="module" client:load>
    // JavaScript code for handling category selection
    document.addEventListener("DOMContentLoaded", () => {
      const categoryButtons = document.querySelectorAll(".categories__catBtn");

      categoryButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          const categoryId = event.target.getAttribute("data-category-id");
          
          // Fetch the selected category
          fetch(`http://localhost:1337/api/categories/${categoryId}?populate=books`)
            .then((response) => response.json())
            .then((data) => {
              const selectedCategory = data.data;
              const books = selectedCategory.books;

              // Dynamically update the book display
              const cardContainer = document.querySelector(".card-container");
              cardContainer.innerHTML = ""; // Clear existing books

              books.forEach((book) => {
                // Create and append book cards dynamically
                const card = document.createElement("div");
                card.classList.add("card");
                card.innerHTML = `
                  <h3>${book.title}</h3>
                  <p>${book.author}</p>
                `;
                cardContainer.appendChild(card);
              });
            });
        });
      });
    });
  </script>
</Layout>

<style>
  .categories {
    display: flex;
    justify-content: space-between;
  }

  .categories__catBtn {
    padding: 1rem 2rem;
    background-color: var(--c-green);
    cursor: pointer;
    transition: background-color 0.2s;
    margin-bottom: 10px;
  }

  .categories__catBtn:hover {
    background-color: var(--c-darkgreen);
    color: white;
  }

  .card-container {
    margin-top: 20px;
  }

  .card {
    padding: 10px;
    border: 1px solid #ddd;
    margin-bottom: 10px;
  }
</style>
